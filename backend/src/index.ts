import { CONFIG } from '@/config';
import { AuthMiddleware } from '@/middlewares';
import { AuthRoutes, V1Routes } from '@/routes';
import type { Variables } from '@/types';
import { S3 } from '@/utils';
import { ListBucketsCommand } from '@aws-sdk/client-s3';
import { Hono } from 'hono';
import mongoose from 'mongoose';

const main = async () => {
  console.log('ðŸ”§ Config');
  console.table(CONFIG);

  console.log('ðŸŸ¡ Connecting to database...');
  await mongoose.connect(CONFIG.MONGO_URI).catch(err => {
    console.error(err);
    process.exit(1);
  });
  console.log('ðŸŸ¢ Connected to database');

  console.log('ðŸŸ¡ Connecting to S3...');
  const s3 = new S3();
  const command = new ListBucketsCommand({});
  await s3.send(command);

  console.log('ðŸŸ¢ Connected to S3');

  console.log('ðŸŸ¡ Starting server...');
  const app = new Hono<{ Variables: Variables }>();

  app.get('/', c =>
    c.text(`
    
  â–“â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  â–„â–ˆâ–ˆâ–ˆâ–ˆâ–„   â–ˆâ–ˆâ–‘ â–ˆâ–ˆ  â–’â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ   â–„â–ˆâ–ˆâ–ˆâ–ˆâ–„   â–ˆâ–ˆâ–‘ â–ˆâ–ˆ  â–„â–„â–„       â–ˆâ–ˆâ–ˆâ–„ â–„â–ˆâ–ˆâ–ˆâ–“ â–„â–„â–„â–„   â–“â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  â–ˆâ–ˆâ–€â–ˆâ–ˆâ–ˆ  
  â–“â–ˆ   â–€ â–’â–ˆâ–ˆâ–€ â–€â–ˆ  â–“â–ˆâ–ˆâ–‘ â–ˆâ–ˆâ–’â–’â–ˆâ–ˆâ–’  â–ˆâ–ˆâ–’â–’â–ˆâ–ˆâ–€ â–€â–ˆ  â–“â–ˆâ–ˆâ–‘ â–ˆâ–ˆâ–’â–’â–ˆâ–ˆâ–ˆâ–ˆâ–„    â–“â–ˆâ–ˆâ–’â–€â–ˆâ–€ â–ˆâ–ˆâ–’â–“â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–„ â–“â–ˆ   â–€ â–“â–ˆâ–ˆ â–’ â–ˆâ–ˆâ–’
  â–’â–ˆâ–ˆâ–ˆ   â–’â–“â–ˆ    â–„ â–’â–ˆâ–ˆâ–€â–€â–ˆâ–ˆâ–‘â–’â–ˆâ–ˆâ–‘  â–ˆâ–ˆâ–’â–’â–“â–ˆ    â–„ â–’â–ˆâ–ˆâ–€â–€â–ˆâ–ˆâ–‘â–’â–ˆâ–ˆ  â–€â–ˆâ–„  â–“â–ˆâ–ˆ    â–“â–ˆâ–ˆâ–‘â–’â–ˆâ–ˆâ–’ â–„â–ˆâ–ˆâ–’â–ˆâ–ˆâ–ˆ   â–“â–ˆâ–ˆ â–‘â–„â–ˆ â–’
  â–’â–“â–ˆ  â–„ â–’â–“â–“â–„ â–„â–ˆâ–ˆâ–’â–‘â–“â–ˆ â–‘â–ˆâ–ˆ â–’â–ˆâ–ˆ   â–ˆâ–ˆâ–‘â–’â–“â–“â–„ â–„â–ˆâ–ˆâ–’â–‘â–“â–ˆ â–‘â–ˆâ–ˆ â–‘â–ˆâ–ˆâ–„â–„â–„â–„â–ˆâ–ˆ â–’â–ˆâ–ˆ    â–’â–ˆâ–ˆ â–’â–ˆâ–ˆâ–‘â–ˆâ–€  â–’â–“â–ˆ  â–„ â–’â–ˆâ–ˆâ–€â–€â–ˆâ–„  
  â–‘â–’â–ˆâ–ˆâ–ˆâ–ˆâ–’â–’ â–“â–ˆâ–ˆâ–ˆâ–€ â–‘â–‘â–“â–ˆâ–’â–‘â–ˆâ–ˆâ–“â–‘ â–ˆâ–ˆâ–ˆâ–ˆâ–“â–’â–‘â–’ â–“â–ˆâ–ˆâ–ˆâ–€ â–‘â–‘â–“â–ˆâ–’â–‘â–ˆâ–ˆâ–“ â–“â–ˆ   â–“â–ˆâ–ˆâ–’â–’â–ˆâ–ˆâ–’   â–‘â–ˆâ–ˆâ–’â–‘â–“â–ˆ  â–€â–ˆâ–“â–‘â–’â–ˆâ–ˆâ–ˆâ–ˆâ–’â–‘â–ˆâ–ˆâ–“ â–’â–ˆâ–ˆâ–’
  â–‘â–‘ â–’â–‘ â–‘â–‘ â–‘â–’ â–’  â–‘ â–’ â–‘â–‘â–’â–‘â–’â–‘ â–’â–‘â–’â–‘â–’â–‘ â–‘ â–‘â–’ â–’  â–‘ â–’ â–‘â–‘â–’â–‘â–’ â–’â–’   â–“â–’â–ˆâ–‘â–‘ â–’â–‘   â–‘  â–‘â–‘â–’â–“â–ˆâ–ˆâ–ˆâ–€â–’â–‘â–‘ â–’â–‘ â–‘â–‘ â–’â–“ â–‘â–’â–“â–‘
   â–‘ â–‘  â–‘  â–‘  â–’    â–’ â–‘â–’â–‘ â–‘  â–‘ â–’ â–’â–‘   â–‘  â–’    â–’ â–‘â–’â–‘ â–‘  â–’   â–’â–’ â–‘â–‘  â–‘      â–‘â–’â–‘â–’   â–‘  â–‘ â–‘  â–‘  â–‘â–’ â–‘ â–’â–‘
     â–‘   â–‘         â–‘  â–‘â–‘ â–‘â–‘ â–‘ â–‘ â–’  â–‘         â–‘  â–‘â–‘ â–‘  â–‘   â–’   â–‘      â–‘    â–‘    â–‘    â–‘     â–‘â–‘   â–‘ 
     â–‘  â–‘â–‘ â–‘       â–‘  â–‘  â–‘    â–‘ â–‘  â–‘ â–‘       â–‘  â–‘  â–‘      â–‘  â–‘       â–‘    â–‘         â–‘  â–‘   â–‘     
         â–‘                         â–‘                                           â–‘                 
  `),
  );

  app.route('/auth', AuthRoutes);
  app.use('/api/*', AuthMiddleware);
  app.route('/api/v1', V1Routes);

  Bun.serve({
    ...app,
    port: CONFIG.PORT,
  });

  console.log(`ðŸŸ¢ Server is running on port ${CONFIG.PORT}`);
};

main();
